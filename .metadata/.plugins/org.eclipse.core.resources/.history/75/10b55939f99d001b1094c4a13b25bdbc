<%@ page language="java" contentType="text/html; charset=ISO-8859-1"
    pageEncoding="ISO-8859-1"%>
<!DOCTYPE html>
<html>
<head>
<meta charset="ISO-8859-1">
<title>Insert title here</title>
</head>
<body>
	<%@ page import="BasicServlet.*" %>
	<%@ page import="java.sql.*" %>
	
	<%
		HttpSession s= request.getSession(true);
		Employee emp=(Employee) s.getAttribute("emp");
		WorkProgress wpr=null;
		DNET DNet=new DNET();
		Connection dbConnection=DNet.getConnection();
		PreparedStatement pStatement;
		int i=1;
		String projectId=request.getParameter("projectId"+i);
		while(projectId!=null) {
			String projectName=request.getParameter("projectName"+i);
			String projectDesc=request.getParameter("projectDesc"+i);
			String WPDate=request.getParameter("WPDate"+i);
			String status=request.getParameter("status"+i);
			String PDC=request.getParameter("PDC"+i);
			wpr=new WorkProgress(emp.persno,WPDate,projectId,projectName,projectDesc,status,PDC);
			try {
				pStatement=dbConnection.prepareStatement("INSERT INTO "+DNet.MPR_WorkProgress+" VALUES(?,TO_DATE(?,'YYYY/MM/DD'),?,?,TO_DATE(?,'YYYY/MM/DD'))");
				pStatement.setString(1,wpr.persno)
	;			pStatement.setString(2, wpr.wpDate);
				pStatement.setString(3,wpr.projectId);
				pStatement.setString(4,wpr.status);
				pStatement.setString(5,wpr.PDC);
				pStatement.executeUpdate();
				pStatement=dbConnection.prepareStatement("INSERT INTO "+DNet.Project+" VALUES(?,?,?)");
				pStatement.setString(1,wpr.projectId);
				pStatement.setString(2,wpr.projectName);
				pStatement.setString(3,wpr.projectDescription);
				pStatement.executeUpdate();
			} catch (SQLException e) {
				e.printStackTrace();
			}
			i++;
			projectId=request.getParameter("projectId"+i);
		}
		RequestDispatcher rd=request.getRequestDispatcher("home.jsp");
		rd.forward(request, response);
	%>
</body>
</html>